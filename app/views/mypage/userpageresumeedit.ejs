<%- contentFor('style') %> <%- contentFor('content') %>
<div class="tr-profile section-padding">
    <div class="container">
        <div class="row">
            <div class="col-md-4 col-lg-3">
                <div class="tr-sidebar">
                    <ul class="nav nav-tabs profile-tabs section" role="tablist">
                        <li role="presentation"><a href="/mypage/user" ><i class="fa fa-life-ring" aria-hidden="true"></i>내 정보</a></li>
                        <!-- <li role="presentation"><a href="/mypage/user/create"><span><i class="fa fa-plus" aria-hidden="true"></i></span> 이력서 생성</a></li> -->
                        <li role="presentation"><a href="/mypage/user/resume" ><span><i class="fa fa-user-o" aria-hidden="true"></i></span> 내 이력서</a></li>
                        <li role="presentation"><a class="active" href="/mypage/user/edit" ><span><i class="fa fa-pencil-square-o" aria-hidden="true"></i></span> 이력서 수정</a></li>
                        <li role="presentation"><a href="/mypage/user/bookmark" ><span><i class="fa fa-bookmark-o" aria-hidden="true"></i></span> 북마크</a></li>
                        <li role="presentation"><a href="/mypage/user/support" ><span><i class="fa fa-clone" aria-hidden="true"></i></span> 지원 현황</a></li>
                        <li role="presentation"><a href="/mypage/user/remove" ><span><i class="fa fa-remove" aria-hidden="true"></i></span> 계정 삭제</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-8 col-lg-9">
                <div style="display: none;">
                    <% console.log(user) %>)
                    <input id="seqseq" value="<% user %>)" name="user-seq">
                </div>
                <div role="tabpanel" class="tab-pane edit-resume section">
                    <ul class="tr-list resume-info">
                        <li class="personal-deatils code-edit-small">
                            <div class="media-body">
                                <span class="tr-title">이력서</span>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <label>제목<span class="pull-right">:</span> </label>
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="code-edit" name="subject" id="subject"></div>
                                    </div>
                                </div>
                                <div class="change-photo">
                                    <div class="user-image">
                                        <% if (get.PHOTO) {%><img src='<%=hostName %>/api/files/get/<%=get.PHOTO %>'alt="Icon" class="img-fluid"><% } %>
                                    </div>
                                    <div class="btn btn-primary" id="imageuploadbotton">이미지 업로드</div>
                                    <!-- <div class="upload-photo">
                                        <label class="btn btn-primary" for="upload-photo" >사진 업로드</label>
                                        <input type="file" id="upload-photo">
                                        <span class="max-size">Max 20 MB</span>
                                    </div> -->
                                </div>
                            </div>
                        </li>
                        <li class="personal-deatils code-edit-small">
                            <div class="media-body">
                                <span class="tr-title">개인정보</span>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <label>이름<span class="pull-right">:</span> </label>
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="code-edit" name="name" id="name"></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <label>연락처<span class="pull-right">:</span> </label>
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="code-edit" name="contact" id="contact"></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <label>이메일<span class="pull-right">:</span> </label>
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="code-edit" name="email" id="email"></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <label>성별<span class="pull-right">:</span> </label>
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="code-edit" name="gender" id="gender" ></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <label>주소<span class="pull-right">:</span> </label>
                                    </div>
                                    <div class="col-sm-8">
                                        <input type="text" id="postcode" placeholder="우편번호">
                                        <input type="button" onclick="sample6_execDaumPostcode()" value="우편번호 찾기"><br>
                                        <input type="text" id="address" placeholder="주소"><br>
                                        <input type="text" id="addressExtra" placeholder="상세주소">
                                        <input type="text" style="display: none;" id="sample6_extraAddress" placeholder="참고항목">
                                    </div>
                                </div>
                            </div>
                        </li>
                        
                        <li class="education-background code-edit-small">
                            <div class="media-body additem-edu">
                                <span class="tr-title">학력 사항</span>
                                <div class="media-body additem-edu">
                                    <div class="code-edit-small">
                                        <div class="row">
                                            <div class="col-sm-4">
                                                <label>학위</label>
                                            </div>
                                            <div class="col-sm-8">    
                                                <div class="dropdown">
                                                    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    선택하세요.
                                                    </button>
                                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                        <a class="dropdown-item" href="#">초등학교 졸업</a>
                                                        <a class="dropdown-item" href="#">중학교 졸업</a>
                                                        <a class="dropdown-item" href="#">고등학교 졸업</a>
                                                        <a class="dropdown-item" href="#">대학교 졸업</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-4">
                                            <label>최종학력<span class="pull-right">:</span> </label>
                                        </div>
                                        <div class="col-sm-8">
                                            <div class="code-edit" id="EDUCATIONSCHOOL" name="EDUCATIONSCHOOL"></div>
                                        </div>
                                    </div>
                                </div>
                            </div><!-- /.additem -->
                        </li>
                        <!-- /.education-background -->
                        <li class="qualification code-edit-small">
                            <div class="media-body">
                            <span class="tr-title">보유기술 및 자격증</span>
                            <div class="row">
                                <div class="col-sm-4">
                                    <label>보유기술<span class="pull-right">:</span> </label>
                                </div>
                                <div class="col-sm-8">
                                    <div class="code-edit" name="TECHNICAL" id="technical"></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4">
                                    <label>자격증<span class="pull-right">:</span> </label>
                                </div>
                                <div class="col-sm-8">
                                    <div class="code-edit" name="LICENSE" id="license"></div>
                                </div>
                            </div>
                        </div>
                        </li>
                        <!-- /.qualification -->
                        <li class="findjob code-edit-small">
                            <div class="media-body">
                            <span class="tr-title">취업 우대사항</span>
                            <div class="row">
                                <div class="col-sm-4">
                                    <label>보훈대상<span class="pull-right">:</span> </label>
                                </div>
                                <div class="col-sm-8">
                                    <div class="code-edit" name="ISWELFARE" id="iswelfare"></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4">
                                    <label>병역<span class="pull-right">:</span> </label>
                                </div>
                                <div class="col-sm-8">
                                    <div class="code-edit" name="ISMILITALY" id="ismilitaly"></div>
                                </div>
                            </div>
                        </div>
                        </li>
                        <li class="career-objective">
                            <div class="media-body">
                                <span class="tr-title">4대보험 증명 서류</span>
                                <div class="upload-photo">
                                    <!-- <label class="btn btn-primary" for="upload-certificate" >업로드</label> -->
                                    <input type="file" id="upload-certificate">
                                </div>
                            </div>
                        </li>
                        <li class="personal-deatils">
                            <div class="media-body">
                                <span class="tr-title">소개</span>
                                <div class="code-edit" name="" id="introduce"></div>
                            </div>
                        </li>
                        <li class="work-history">
                            <div class="media-body additem-work">
                                <span class="tr-title">경력</span>
                                <div id="addhistory" class="additem">
                                    <span id="clone" class="icon clone"><i class="fa fa-plus" aria-hidden="true"></i></span>
                                    <span class="icon remove"><i class="fa fa-times" aria-hidden="true"></i></span>
                                    <div class="code-edit-small">
                                        <label>직업</label>
                                        <div class="code-edit"><span>마트 매니저</span></div>
                                        <label>마트 이름</label>
                                        <div class="code-edit"><span>홈마트 부천</span></div>
                                        <div class="row">
                                            <div class="col-sm-6 col-md-4">
                                                <label>시작</label>
                                                <div class="calendar">
                                                    <input type="date" class="form-control" value="2015-01-15" />
                                                </div>
                                                <!-- calendar -->
                                            </div>
                                            <div class="col-sm-6 col-md-4">
                                                <label>끝</label>
                                                <div class="calendar">
                                                    <input type="date" class="form-control" value="2016-01-13" />
                                                </div>
                                                <!-- calendar -->
                                            </div>
                                            <div class="col-md-4">
                                                <div class="checkbox">
                                                    <label for="logged-1"><div type="checkbox" name="logged-1" id="logged-1" />재직중입니다.</label>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-sm-4 col-md-3">
                                                <label>경력기간</label>
                                                <div class="code-edit"><span></span></div>
                                            </div>
                                            <div class="col-sm-4 col-md-3">
                                                <label>직종</label>
                                                <div class="code-edit"><span></span></div>
                                            </div>
                                            <div class="col-sm-4 col-md-3">
                                                <label>직급</label>
                                                <div class="code-edit"><span></span></div>
                                            </div>
                                            <div class="col-sm-4 col-md-3">
                                                <label>담당 업무</label>
                                                <div class="code-edit"><span></span></div>
                                            </div>
                                        </div>
                                        <label>근무 지역</label>
                                        <div class="code-edit"><span>경기</span></div>
                                        <label>최종 연봉</label>
                                        <div class="code-edit"><span>9,700 만원</span></div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <!-- /.work-history -->
                    </ul>
                    <div class="buttons pull-right">
                        <a href="#" class="btn button-cancle">취소</a>
                        <a href="#" id="resume-update-btn" class="btn btn-primary">수정</a>
                    </div>
                </div>
                <!-- /.tab-pane -->
            </div>
            </div>
            <!-- /.row -->
        </div>
        <!-- /.container -->
    </div>
    <!-- /.tr-profile -->
</div>

<!-- 이미지 업로드 모달창 -->
<input type="hidden" id="createType" />
<div id="imgUploadModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="imgUploadModal" aria-hidden="true" style="display: none">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="imgUploadModal-Title"></h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <div class="upload-photo">
                                <!-- <label class="btn btn-primary" for="upload-photo" >사진 업로드</label> -->
                                <input type="file" id="upload-photo">
                                <span class="max-size">Max 20 MB</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">닫기</button>
                    <button type="button" class="btn btn-info waves-effect waves-light" id="button-actionUpload">저장</button>
                </div>
            </div>
            
        </div>
    </div>
</div>
    <%- contentFor('script') %>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
    $(document).ready(function(){
        $("#imageuploadbotton").click(function(){
            $('#imgUploadModal').modal();
        });
        $("#button-actionUpload").click(function(){
            uploadImage();
        })
        $("#resume-update-btn").click(function(){
            let userseq = user.Seq;
            // 수정 완료 클릭시 > api로 호출하는 front 로직 수행(body) >  POST로 (body) api로 전송하여 이력서 seq로 업데이트
            doPostCallSync("/mypage/user/edit/"+userseq, {
                            seq: userseq,
                            subject: $("#subject").val(),
                            // 모달을 만들어서 업로드하게할지 ???
                            photo: $("#").val(),
                            name: $("#name").val(),
                            contact: $("#contact").val(),
                            email: $("#email").val(),
                            postCode: $("#postCode").val(),
                            address: $("#address").val(),
                            addressExtra: $("#addressExtra").val(),
                            //  드랍다운 버튼형식 유지할지?
                            education: $("#").val(),
                            educcationSchool: $("#EDUCATIONSCHOOL").val(),
                            // 경력이 있다면?? 확인 필요. 
                            carrerSeq: $("#").val(),
                            technical: $("#technical").val(),
                            license: $("#license").val(),
                            isWelfare: $("#isWelfare").val(),
                            isMilitaly: $("#isMilitaly").val(),
                            // 모달로 할지, 그리고 파일 업로드가되면 업로드된 파일의 DB seq 가 들어가야함.
                            carrerCertificate: $("#").val(),
                            introduce: $("#introduce").val(),
                            // 1, 2, 3      ||||||||| 정규직, 계약직, 일용직
                            // 선택하는곳 만들어야함.
                            workingTypeSeqs: $("#").val(),
                            workingTypeNames: $("#").val(),
                            // 희망연봉이 맞는지?? 선택하게 만들어야함.
                            salary: $("#").val()
                        })
                        .success(function(json){
                            if (json.result == "success"){
                                location.reload();
                            }
                        })
                        .fail(function(sender, message, details){
                            alert("이력서 업데이트 오류 발생..");
                            return false;
                        });
        })
    })
    function uploadImage(){
        var logoImage = null;
        var titleImage = null;
        // 파일이 있으면 먼저 업로드한다 
        if ($("#upload-photo").val() != "") {
            var formData = new FormData();
            formData.append("location", 'resume');
            formData.append("uploadFile", $('#upload-photo')[0].files[0]);
            $.ajax({
                url: hostName + '/api/files/uploadSingle',  
                type: 'POST',
                dataType: "json",
                data: formData,
                async: false,
                success:function(json){
                    // 업로드가 성공했으면 정보를 업데이트
                    if (json.result == "success") {
                    logoImage = json.data.filename;
                    doPostCallSync("/mypage/updateimage", {
                        SEQ: $("#SEQ").val(),
                        location: 'martlogo',
                        LOGOFILE: logoImage
                    })
                    .success(function(json){
                        if (json.result == "success") location.reload();
                    })
                    .fail(function(sender, message, details){
                        alert("로고 이미지를 변경하는 도중에 오류가 발생했습니다.");
                    });                         
                }
                },
                cache: false,
                contentType: false,
                processData: false
            }); 
        }
    }
    function sample6_execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var addr = ''; // 주소 변수
                var extraAddr = ''; // 참고항목 변수

                //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                    addr = data.roadAddress;
                } else { // 사용자가 지번 주소를 선택했을 경우(J)
                    addr = data.jibunAddress;
                }

                // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
                if(data.userSelectedType === 'R'){
                    // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                    // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                    if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                        extraAddr += data.bname;
                    }
                    // 건물명이 있고, 공동주택일 경우 추가한다.
                    if(data.buildingName !== '' && data.apartment === 'Y'){
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                    if(extraAddr !== ''){
                        extraAddr = ' (' + extraAddr + ')';
                    }
                    // 조합된 참고항목을 해당 필드에 넣는다.
                    document.getElementById("sample6_extraAddress").value = extraAddr;
                
                } else {
                    document.getElementById("sample6_extraAddress").value = '';
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('postcode').value = data.zonecode;
                document.getElementById("address").value = addr;
                // 커서를 상세주소 필드로 이동한다.
                document.getElementById("addressExtra").focus();
            }
        }).open();
    }
</script>